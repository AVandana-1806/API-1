//created on: Oct 15, 2018
import gov.ca.cwds.data.legacy.cms.entity.CsecHistory;
import gov.ca.cwds.data.legacy.cms.entity.syscodes.SexualExploitationType;
import gov.ca.cwds.rest.exception.IssueDetails

global java.util.Set validationDetailsList

/*
   DocTool Rule: R - 10971
 
   If the CSEC Type is 'Victim while Absent from Placement' make the End Date mandatory.

   If COMMERCIAL_SEXUAL_EXPLOITATION_HISTORY (where .Sexual_Exploitation_Type 
   = 'Victim while Absent from Placement') make txtEndDate mandatory.
  
*/

rule "R-10971"
	dialect "mvel"
	agenda-group "commercial-sexual-exploitation-agenda"

    when
    		$csecHistory: CsecHistory()
    		$sexualExploitationType: SexualExploitationType() 
    			from $csecHistory.getSexualExploitationType()
    		eval ($csecHistory.endDate == null && $sexualExploitationType.getSystemId == 6871)

    then
        IssueDetails details = new IssueDetails();
        details.setCode("R-10971");
        details.setUserMessage("CSEC Victim while Absent from Placement requires an end date");
        details.setTechnicalMessage("If the CSEC Type is 'Victim while Absent from Placement' make the End Date mandatory.")
        validationDetailsList.add(details);
end
